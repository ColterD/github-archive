#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MIMIR PROTOCOL ENFORCEMENT - PRE-COMMIT HOOK
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Validates that Copilot conversations include Mimir queries
# Blocks commits if protocol violations detected
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo "ğŸ” Checking Mimir Protocol Compliance..."

# Check for conversation logs or AI-generated files with protocol violations
if git diff --cached --name-only | grep -E '(\.md|\.txt|AGENTS\.md|copilot-instructions\.md)'; then
  echo "âœ… Files being committed may contain AI instructions"
  echo "âš ï¸  Manual verification required: Did you query Mimir at the START?"
  echo "   Required queries:"
  echo "   1. mcp_mimir_vector_search_nodes (with user keywords)"
  echo "   2. mcp_mimir_memory_node (operation=query, type=memory)"
  echo "   3. mcp_mimir_memory_node (operation=query, type=concept)"
  echo ""
  echo "Press ENTER to confirm compliance, or Ctrl+C to abort"
  read -r confirmation
fi

# Run normal pre-commit checks
npm run lint --if-present
npm run format:check --if-present

echo "âœ… Pre-commit checks passed"

[unix_http_server]
file=/var/run/supervisor/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=/var/run/supervisor/supervisord.pid

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor/supervisor.sock

; Miner program
[program:srbminer]
command=/srbminer/bin/SRBMiner-Multi/SRBMiner-MULTI --config /srbminer/config/config.json
directory=/srbminer/bin/SRBMiner-Multi
user=miner
autostart=true
autorestart=true
startsecs=10
startretries=3
stdout_logfile=/var/log/srbminer.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/srbminer_error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
environment=GPU_FORCE_64BIT_PTR=1,GPU_MAX_HEAP_SIZE=100,GPU_USE_SYNC_OBJECTS=1,GPU_MAX_ALLOC_PERCENT=100,GPU_SINGLE_ALLOC_PERCENT=100

; Health check program
[program:health-check]
command=/srbminer/scripts/health-check.sh
user=root
autostart=true
autorestart=false
startsecs=0
startretries=3
stdout_logfile=/var/log/health-check.log
stdout_logfile_maxbytes=1MB
stdout_logfile_backups=3
stderr_logfile=/var/log/health-check_error.log
stderr_logfile_maxbytes=1MB
stderr_logfile_backups=3
exitcodes=0,1,2

; Health check timer
[program:health-check-timer]
command=bash -c "while true; do sleep 300; supervisorctl start health-check; done"
user=root
autostart=true
autorestart=true
startsecs=0
startretries=3
stdout_logfile=/dev/null
stderr_logfile=/dev/null